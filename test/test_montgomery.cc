#include <stdio.h>
#include <stdlib.h>
#include <string>
#include <iostream>
#include <gtest/gtest.h>
#include <mympz/mympz.h>

using namespace mympz;

// TEST(Mympz, MontgomeryCtx) {
//   bignum_t m;
//   std::string rr_str;
//   montgomery_ctx_t mctx;

//   m = create(
//     "AADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223AAF"
//     "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
//     "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
//     "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
//     "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
//     "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
//     "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
//     "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
//   ,true);

//   mctx = montgomery_ctx_create(m);
//   rr_str = print_string(mctx.RR, true);
//   std::cout << "RR = " << rr_str << std::endl;
// }

// RR = 72E68DCD57891C1ECA553DE96785916ADC823EE7788E9D666536090775F7B470272AD1E18215025888896FDC3B3537B2E1F7AC48631848B05879E5BB32CF0AEECD2557499354CAB02F057B8B243E05EBCA3E6BEB537ED5DF048CA78608C4D75A7BFC4B56D9A52EC02C58FEB603796E732FC8A9CD53161C01B5EA84CC3BD86165B2626A4E37451B09D5017AACCA728B6EE46BA5E8347997B9A5B413C1A162B6F2FF85B952740881172F5F9F34EAB1DC8FB6725083DC0F4D7A1522672EDF4C57138216F72C63E63183C98C01FF60F8B1E5C2F7209155FF75F9B81E09BE1D568AB0C67F97F8996B192894231745B216BF03088B7BFDE3D698B4EE2A8CB70251ED2C
// N = AADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223AAF44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233
// Ni = C520A3FF8B16F1F8A0F1F599D3656A9C8429BA6F2668D14FA71925314F9505D4B818214BAD02EF644BEA535D503F7376FE3DDABDA34BD2A139C47ADB060959F67A21B74A7F7A59F7DA4C14128ED6FF0533D5B0B04D17DA3E8C67AD71D579750F2BF371518BE0D28391FEF67CAD573CD27CADB6F7460D826422F22208530E2013AC4E996019027A7E6BEBFAB2C559BD4263377645CE30F580E7CCD4487F114E2D868F442576F5378671E8317AA27DC76A8E1043E942DDE4C8C666A505B4D9B100B917782D41ABBE4E89841174F23CC8A47EF6A008A9994B5229D803205978041984AD2479C00E44044B4E810874563DDC96DB29BA4CE36683DE7A08E8F6C95705

TEST(Mympz, MontgomeryModMul) {
  bignum_t x, y, z, m;
  std::string rr_str, n_str, ni_str;//, x_str, y_str, z_str;
  montgomery_ctx_t mctx;

  // m = create(
  //   "AADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223AAF"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  // ,true);
  m = create("259341");

  mctx = montgomery_ctx_create(m);
  rr_str = print_string(mctx.RR);
  n_str = print_string(mctx.N);
  ni_str = print_string(mctx.Ni);
  std::cout << "RR = " << rr_str << std::endl;
  std::cout << "N = " << n_str << std::endl;
  std::cout << "Ni = " << ni_str << std::endl;

  x = create("1234");
  // x = create(
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "AADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223AAF"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  // ,true);

  y = create("4564");
  // y = create(
  //   "0xAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "4DDCAADD11223344FFBCDEA1234DDCDDCCAABB1289232CCAABB1289232CCAABB"
  //   "44FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA123"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  //   "FFAADD11223344FFBCDEA1234DDCAADD11223344FFBCDEA1234DDCAADD112233"
  // ,true);

  z = montgomery_mod_mul(x, y, mctx);
  std::cout << "z = " << print_string(z) << std::endl;

  z = mod_mul(x, y, m);
  std::cout << "z = " << print_string(z) << std::endl;
}

int main(int argc, char* argv[]) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}